<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A4Tech & Bloody Store</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:#f5f5f5;color:#333;line-height:1.6}
header{background:#00AEEF;color:#fff;padding:15px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
.header-content{display:flex;justify-content:space-between;align-items:center}
h1{font-size:1.8rem;font-weight:600}
.cart-icon{position:relative;font-size:1.5rem;cursor:pointer;padding:10px;border-radius:50%;background:rgba(255,255,255,0.2);width:50px;height:50px;display:flex;align-items:center;justify-content:center}
.cart-count{position:absolute;top:-5px;right:-5px;background:#ff4757;color:#fff;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;font-weight:bold}
.controls{display:flex;justify-content:space-between;margin:20px 0;background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.search-box{padding:8px 15px;border:1px solid #ddd;border-radius:5px;width:250px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:25px;margin-bottom:40px}
.product-card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.05);transition:.3s}
.product-card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.1)}
.product-image{width:100%;height:220px;object-fit:cover}
.product-info{padding:15px}
.product-title{font-size:1.1rem;margin-bottom:5px}
.product-price{font-weight:700;color:#25D366;margin:8px 0}
.add-to-cart{background:#25D366;color:white;border:none;padding:8px 15px;border-radius:6px;cursor:pointer;width:100%}
.add-to-cart:hover{background:#128C7E}
.cart-popup{position:fixed;top:0;right:-400px;width:100%;max-width:380px;height:100vh;background:#fff;box-shadow:-5px 0 15px rgba(0,0,0,0.1);transition:right .4s ease;z-index:1000;display:flex;flex-direction:column}
.cart-popup.active{right:0}
.cart-header{padding:20px;background:#25D366;color:white;display:flex;justify-content:space-between;align-items:center}
.cart-items{flex:1;overflow-y:auto;padding:20px}
.cart-footer{padding:20px;border-top:1px solid #eee}
.checkout-btn{background:#25D366;color:#fff;border:none;padding:12px;border-radius:6px;width:100%;font-weight:600;cursor:pointer}
.checkout-btn:hover{background:#128C7E}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:900}
.overlay.active{display:block}
</style>
</head>
<body>
<div class="overlay" id="overlay"></div>
<header>
  <div class="container header-content">
    <h1>A4Tech & Bloody Store</h1>
    <div style="display:flex;align-items:center;gap:10px;">
      <button id="refreshBtn" style="background:white;color:#00AEEF;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;font-weight:600">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
      <div class="cart-icon" id="cartIcon">
        <i class="fas fa-shopping-cart"></i>
        <div class="cart-count" id="cartCount">0</div>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="controls">
    <input type="text" class="search-box" id="searchBox" placeholder="Search products...">
  </div>
  <div class="products-grid" id="productsGrid"></div>
</div>

<div class="cart-popup" id="cartPopup">
  <div class="cart-header">
    <h2>Your Cart</h2>
    <button id="closeCart" style="background:none;border:none;color:white;font-size:1.3rem;cursor:pointer"><i class="fas fa-times"></i></button>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer">
    <div style="display:flex;justify-content:space-between;font-weight:700;margin-bottom:10px;">
      <span>Total:</span><span id="cartTotal">Rs. 0</span>
    </div>
    <button class="checkout-btn" id="checkoutBtn"><i class="fab fa-whatsapp"></i> Checkout via WhatsApp</button>
  </div>
</div>

<script>
const DATA_FILE_URL = './products.json';
const WHATSAPP_NUMBER = '923001234567';

let products = [];
let cart = [];

async function loadProducts(){
  try{
    const res = await fetch(DATA_FILE_URL+'?t='+Date.now());
    if(!res.ok) throw new Error('Failed');
    const data = await res.json();
    products = data.products || data;
    renderProducts();
  }catch(e){
    document.getElementById('productsGrid').innerHTML='<p style="color:red">Failed to load products.json</p>';
  }
}

function renderProducts(filter=''){
  const grid=document.getElementById('productsGrid');
  grid.innerHTML='';
  const f=filter.toLowerCase();
  const list=products.filter(p=>!f || (p.name||'').toLowerCase().includes(f)||(p.description||'').toLowerCase().includes(f));
  list.forEach(p=>{
    const card=document.createElement('div');
    card.className='product-card';
    card.innerHTML=`
      <img src='${p.image||"https://via.placeholder.com/250x250"}' class='product-image' alt='${p.name}'>
      <div class='product-info'>
        <h3 class='product-title'>${p.name}</h3>
        <p class='product-description'>${p.description||''}</p>
        <div class='product-price'>Rs. ${p.price}</div>
        <button class='add-to-cart' onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
      </div>`;
    grid.appendChild(card);
  });
}

function addToCart(p){
  const f=cart.find(i=>i.name===p.name);
  if(f)f.qty++;else cart.push({...p,qty:1});
  updateCart();
}

function updateCart(){
  const items=document.getElementById('cartItems');
  const totalEl=document.getElementById('cartTotal');
  items.innerHTML='';
  let total=0;
  cart.forEach(i=>{
    const div=document.createElement('div');
    div.style.marginBottom='10px';
    div.innerHTML=`${i.name} x${i.qty} - Rs. ${i.price*i.qty}`;
    items.appendChild(div);
    total+=i.price*i.qty;
  });
  totalEl.textContent='Rs. '+total.toFixed(2);
  document.getElementById('cartCount').textContent=cart.reduce((a,b)=>a+b.qty,0);
}

document.getElementById('checkoutBtn').addEventListener('click',()=>{
  if(cart.length===0)return alert('Your cart is empty!');
  let msg='ðŸ› *Order Details:*\n';
  let total=0;
  cart.forEach(i=>{msg+=`â€¢ ${i.name} x${i.qty} = Rs ${i.price*i.qty}\n`;total+=i.price*i.qty;});
  msg+=`\n*Total:* Rs ${total.toFixed(2)}\n\nPlease confirm my order.`;
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
});

document.getElementById('cartIcon').addEventListener('click',()=>{document.getElementById('cartPopup').classList.add('active');document.getElementById('overlay').classList.add('active');});
document.getElementById('closeCart').addEventListener('click',()=>{document.getElementById('cartPopup').classList.remove('active');document.getElementById('overlay').classList.remove('active');});
document.getElementById('overlay').addEventListener('click',()=>{document.getElementById('cartPopup').classList.remove('active');document.getElementById('overlay').classList.remove('active');});
document.getElementById('searchBox').addEventListener('input',e=>renderProducts(e.target.value));
document.getElementById('refreshBtn').addEventListener('click',loadProducts);

loadProducts();
</script>
</body>
</html>
